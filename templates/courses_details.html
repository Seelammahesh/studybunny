{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

<style>
  .card-hover { transition: all 0.25s ease-in-out; border-radius: 14px; }
  .card-hover:hover { transform: translateY(-6px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
  .section-title { font-weight: 600; margin-top: 40px; margin-bottom: 20px; }
  .scroll-section { scroll-margin-top: 80px; }
</style>

<div class="container mt-5 mb-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">{{ course.title }}</h2>
    <span class="badge bg-light text-primary fw-semibold p-2 shadow-sm">
      {{ course.credits }} Credits
    </span>
  </div>

  <!-- ===== Cards Section ===== -->
  <div class="row g-4 mb-5">
    {% with sections="Units,Videos,PDFs,Quizzes" %}
      {% for section in sections|cut:","|slice:"0:" %}
      {% endfor %}
    {% endwith %}

    {% for section in sections %}
    <div class="col-md-3 col-sm-6">
      <div class="card text-center shadow-sm border-0 h-100 card-hover">
        <div class="card-body">
          {% if section == "Units" %}<i class="bi bi-journal-text display-5 text-primary mb-3"></i>{% endif %}
          {% if section == "Videos" %}<i class="bi bi-play-circle display-5 text-success mb-3"></i>{% endif %}
          {% if section == "PDFs" %}<i class="bi bi-file-earmark-pdf display-5 text-danger mb-3"></i>{% endif %}
          {% if section == "Quizzes" %}<i class="bi bi-question-circle display-5 text-warning mb-3"></i>{% endif %}
          <h5 class="card-title">{{ section }}</h5>
          <p class="text-muted small">
            {% if section == "Units" %}
              Explore course structure
            {% elif section == "Videos" %}
              Watch all lectures
            {% elif section == "PDFs" %}
              Download notes & references
            {% else %}
              Test your knowledge
            {% endif %}
          </p>
          <a href="#{{ section|lower }}" class="btn btn-outline-{% if section == 'Units' %}primary{% elif section == 'Videos' %}success{% elif section == 'PDFs' %}danger{% else %}warning{% endif %} btn-sm mt-2">
            View {{ section }}
          </a>
        </div>
      </div>
    </div>
  {% endfor %}
  
   
  </div>

  <!-- ===== Units ===== -->
  <section id="units" class="scroll-section">
    <h4 class="section-title">Units</h4>
    {% if units %}
      <div class="accordion" id="unitAccordion">
        {% for unit in units %}
          <div class="accordion-item">
            <h2 class="accordion-header" id="heading{{ forloop.counter }}">
              <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button"
                      data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}">
                {{ unit.title }}
              </button>
            </h2>
            <div id="collapse{{ forloop.counter }}"
                 class="accordion-collapse collapse {% if forloop.first %}show{% endif %}"
                 data-bs-parent="#unitAccordion">
              <div class="accordion-body">{{ unit.description|default:"No description provided." }}</div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">No units available.</p>
    {% endif %}
  </section>

  <!-- ===== Videos ===== -->
  <section id="videos" class="scroll-section">
    <h4 class="section-title">Lecture Videos</h4>
    <div class="row">
      {% if videos %}
        {% for video in videos %}
        <div class="col-md-4 mb-4">
          <div class="card shadow-sm border-0 card-hover">
            <video controls class="card-img-top rounded-top">
              <source src="{{ video.url }}" type="video/mp4" />
            </video>
            <div class="card-body"><h6 class="card-title">{{ video.title }}</h6></div>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <p class="text-muted">No videos available.</p>
      {% endif %}
    </div>
  </section>

  <!-- ===== PDFs ===== -->
  <section id="pdfs" class="scroll-section">
    <h4 class="section-title">PDF Notes</h4>
    <ul class="list-group">
      {% if pdfs %}
        {% for pdf in pdfs %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>{{ pdf.title }}</span>
            <a href="{{ pdf.url }}" target="_blank" class="btn btn-sm btn-outline-primary">View PDF</a>
          </li>
        {% endfor %}
      {% else %}
        <p class="text-muted">No notes yet.</p>
      {% endif %}
    </ul>
  </section>

  <!-- ===== Quizzes ===== -->
  <section id="quizzes" class="scroll-section mb-5">
    <h4 class="section-title">Quizzes</h4>
    <ul class="list-group">
      {% if quizzes %}
        {% for quiz in quizzes %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>{{ quiz.title }}</span>
            <a href="{% url 'take_quiz' quiz.id %}" class="btn btn-sm btn-outline-warning">Take Quiz</a>
          </li>
        {% endfor %}
      {% else %}
        <p class="text-muted">No quizzes available.</p>
      {% endif %}
    </ul>
  </section>
</div>

<script>
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener("click", e => {
      e.preventDefault();
      document.querySelector(this.getAttribute("href")).scrollIntoView({ behavior: "smooth" });
    });
  });
</script>
{% endblock %}
